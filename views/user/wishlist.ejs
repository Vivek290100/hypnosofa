<%- include('header') -%>
<%- include('nav',{user:user}) -%>


<style>
    .imgg{
      height: 200px;
      width: 200px;

    }
    .position-relative {
    position: relative;
}

.position-absolute {
    position: absolute;
}

.bottom-0 {
    bottom: 0;
}

.end-0 {
    right: 0;
}
svg {
    overflow: hidden;
    vertical-align: middle;
    margin-top: -11px;
}
.container {
    height: 80vh;
    position: fixed;
    top: 40px; 
    left: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto; 
    border-radius: 5px;
    margin-top: 50px;
}
.container::-webkit-scrollbar {
    width: 0; 
    height: 0; 
}
.name {
    color: black;
    text-decoration: none; 
}
.name1 {
    color: black;
    text-decoration: none; 
}

.short-desc {
    word-wrap: break-word; 
    font-family: Roboto Arial sans-serif;
}
.price {
    font-family: Roboto, Arial, sans-serif;
    font-size: 28px;
}
.shadow-sm {
    margin-top: 5px;
}
.short-desc{
    width: 40vw;
}
.img-fluid {
    max-width: 100%;
    height: auto;
    margin-left: 37px;
}
.add-to-cart{
    background-color: #004c3f;
    color: #fff;
}
.add-to-cart:hover{
    background-color: #004c3f;
    color: #fff;
}
.single-div-container{
    align-items: center;
}
  </style>
<head>
    <meta charset="UTF-8">
    <title>Bootstrap Components</title>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <% if (products.length > 0) { %>
       <% products.forEach(product => { %>
  <div class="border shadow-sm">
    <div class="row">
      <!-- IMAGE -->
      <div class="col-12 col-md-4">
        <div class="position-relative">
          <a href="/user/mainproduct/<%= product._id %>">
            <% if (product.images && product.images.length > 0) { %>
              <img 
                src="<%= product.images[0] %>" 
                class="img-fluid imgg" 
                alt="<%= product.name %>"
                style="height: 200px; width: 200px; object-fit: cover;"
              >
            <% } else { %>
              <img 
                src="/assets/default-image.jpg" 
                class="img-fluid imgg" 
                alt="No image"
              >
            <% } %>
          </a>

          <!-- DELETE BUTTON -->
          <div 
            class="position-absolute bottom-0 end-0 mb-5 mr-5 deleteButton" 
            data-product-id="<%= product._id %>" 
            data-toggle="tooltip" 
            data-placement="top" 
            title="Remove from Wishlist"
            style="cursor: pointer;"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
              <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- DETAILS -->
      <div class="col-12 col-md-8 d-flex flex-column justify-content-center">
        <a href="/user/mainproduct/<%= product._id %>" class="name">
          <h4><%= product.name %></h4>
        </a>
        <p class="short-desc text-justify"><%= product.description %></p>

        <div class="single-div-container d-flex align-items-center">
          <!-- PRICE -->
          <% if (product.discountedPrice === product.price) { %>
            <h3 style="font-size: 25px; margin: 0;">₹<%= product.price %>/-</h3>
          <% } else { %>
            <h3 style="font-size: 25px; margin: 0;">₹<%= product.discountedPrice.toFixed(0) %></h3>&nbsp;&nbsp;
            <h5 style="color: #999; margin: 0;"><del>₹<%= product.price %></del></h5>&nbsp;&nbsp;
            <h5 style="color: #ac4e4e; margin: 0;"><%= product.offer?.discountPercentage || 0 %>% Off</h5>
          <% } %>&nbsp;&nbsp;&nbsp;

          <!-- ADD TO CART -->
          <a href="/user/addtocart/<%= product._id %>" class="add-to-cart btn btn-default">
            Add to Cart
          </a>
        </div>
      </div>
    </div>
  </div>
<% }); %>
        <% } else { %>
            <div class="text-center mt-3">
                <img src="/assets/homeimg/empty wishlist.png" alt="">
                <h4 class="mt-2">Empty Wishlist</h4>
                <p>You have no items in your wishlist. Start adding!</p>
            </div>
            
        <% } %>    
    </div>
    
</body>

<script>
fetch('/wishlist', {
  method: 'GET',
})
.then(response => response.json())
.then(data => {
  console.log(data);
})
.catch(error => {
  console.error('Error:', error);
});

</script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        const deleteButtons = document.querySelectorAll('.deleteButton');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                console.log('productIddd',productId);
                fetch(`/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        window.location.reload(); 
                    } else {
                        console.error('Failed to delete product from wishlist');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
    });
</script>


<script>
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>