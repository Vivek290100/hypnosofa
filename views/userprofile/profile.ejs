<%- include('userprofilelayout/header') -%>
<%- include('userprofilelayout/nav') -%>

<style>
    body {
    background: #f5f5f5;
    margin-top: 20px;
}

.ui-w-80 {
    width : 80px !important;
    height: auto;
}

.btn-default {
    border-color: rgba(24, 28, 33, 0.1);
    background  : rgba(0, 0, 0, 0);
    color       : #4E5155;
    background-color: #014122;
}

label.btn {
    margin-bottom: 0;
}
.btn {
    cursor: pointer;
}

.text-light {
    color: #0460bb !important;
}

.card {
    background-clip: padding-box;
    box-shadow     : 0 1px 4px rgba(24, 28, 33, 0.012);
}

.row-bordered {
    overflow: hidden;
}

.account-settings-fileinput {
    position  : absolute;
    visibility: hidden;
    width     : 1px;
    height    : 1px;
    opacity   : 0;
}

.account-settings-links .list-group-item.active {
    font-weight: bold !important;
    
}

html:not(.dark-style) .account-settings-links .list-group-item.active {
    background: transparent !important;

}

.account-settings-multiselect~.select2-container {
    width: 100% !important;
}

.light-style .account-settings-links .list-group-item {
    padding     : 0.85rem 1.5rem;
    border-color: rgba(24, 28, 33, 0.03) !important;
}

.light-style .account-settings-links .list-group-item.active {
    color: #4e5155 !important;
}

.material-style .account-settings-links .list-group-item {
    padding     : 0.85rem 1.5rem;
    border-color: rgba(24, 28, 33, 0.03) !important;
}

.material-style .account-settings-links .list-group-item.active {
    color: #4e5155 !important;
    
}

.dark-style .account-settings-links .list-group-item {
    padding     : 0.85rem 1.5rem;
    border-color: rgba(255, 255, 255, 0.03) !important;
}

.dark-style .account-settings-links .list-group-item.active {
    color: #fff !important;
    
}

.light-style .account-settings-links .list-group-item.active {
    color: #4E5155 !important;
}

.light-style .account-settings-links .list-group-item {
    padding     : 0.85rem 1.5rem;
    border-color: rgba(24, 28, 33, 0.03) !important;
}

.address-container {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-right: 15px;
            margin-left: 10px;
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .address-heading {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .address-buttons {
            position: absolute;
            top: 5px;
            right: 5px;
        }

        .address-buttons button {
            margin-left: 5px;
            cursor: pointer;
        }
        .referralcodecolor{
            font-weight: bold;
            width: 80px;
            height: 30px;
            padding-left: 7px;
            background-color: #bababa;
            border-radius: 2px;
        }

</style>














<!--Website: wwww.codingdung.com-->
<!-- <!DOCTYPE html> -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile </title>
    <!-- <link rel="stylesheet" href="style.css"> -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background-color: #fff;">
    <div class="container light-style flex-grow-1 container-p-y ">
        <h4 class="font-weight-bold py-3 mb-4">
            My Account
        </h4>
        <div class="card overflow-hidden">
            <div class="row no-gutters row-bordered row-border-light">
                <div class="col-md-3 pt-0">
                    <div class="list-group list-group-flush account-settings-links" >
                        <a class="list-group-item list-group-item-action active" data-toggle="list"
                            href="#account-general">Account Details</a>
                        <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-change-password">Change password</a>
                        <a class="list-group-item list-group-item-action" data-toggle="list"
                            href="#account-info">Address</a>
                        <a class="list-group-item list-group-item-action" 
                            href="/checkout">Orders / Payments</a>
                        
                            <a class="list-group-item list-group-item-action" 
                                href="/user/userOrder">My Orders</a>
                            <a class="list-group-item list-group-item-action" 
                                href="/coupon">Coupons</a>
                            <a class="list-group-item list-group-item-action" 
                                href="/walletHistory">Wallet History</a>
                            <a class="list-group-item list-group-item-action" 
                            href="/user/logout">Logout</a>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="account-general">
                            <div class="card-body media align-items-center">
                                <img src="/assets/homeimg/user-person-profile-block-account-circle.svg" alt class="d-block ui-w-80">
                            </div>
                            <hr class="border-light m-0">
                            <div class="card-body">
                                <div class="form-group">
                                    <%if(user){%>
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control" id="user-name" value="<%=user.name%>">
                                    <%}%>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">E-mail</label>
                                    <input type="text" class="form-control mb-1" value="<%=user.email%>">
                                </div>
                                <div class="form-group d-flex">
                                    <label class="form-label ">Referal Code:  </label>
                                        <p class="referralcodecolor"><%=referralCode%></p>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Wallet: â‚¹<%= amount%>/-</label>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <button type="button" class="btn" style="background-color: #014122; color: #fff;" id="save-changes">Save changes</button>&nbsp;
                                <!-- <button type="button" class="btn btn-danger">Cancel</button> -->
                            </div>
                        </div>
                        <br><br>


<!-- ===================change password=================================================== -->
                        <div class="tab-pane fade" id="account-change-password">                            <div id="alert-area" class="mt-3"></div>

                            <div class="card-body pb-2">
                            <img src="/assets/homeimg/change pass.png" class="d-block ui-w-80" alt="" >

                                <div class="form-group">
                                    <label class="form-label">Current password</label>
                                    <input id="current-password" type="password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">New password</label>
                                    <input id="new-password" type="password" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Repeat new password</label>
                                    <input id="repeat-new-password" type="password" class="form-control">
                                </div>
                            </div>
                            <div class="text-right mt-3">
                                <button type="button" class="btn " style="background-color: #014122; color: #fff;" id="btn-save-changess" >Save changes</button>&nbsp;
                                <a href="/user/profile"> <button type="button" class="btn btn-danger">Cancel</button> </a>
                            </div>
                            <div id="alert-area" class="mt-3"></div>

                        </div>



<!-- =====================Address===================================== -->
<div class="tab-pane fade" id="account-info">

    <div class="card-body pb-2">
        <form id="address-form" action="" method="post" style="display: none;">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Mobile</label>
                        <input type="text" class="form-control" name="mobile" placeholder="Mobile">
                    </div>
                    <!-- <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" placeholder="Email">
                    </div> -->
                    <div class="form-group">
                        <label class="form-label">Pincode</label>
                        <input type="text" class="form-control" name="pincode" placeholder="Pincode">
                    </div>
                    <div class="form-group">
                        <label class="form-label">House Name</label>
                        <input type="text" class="form-control" name="houseName" placeholder="House Name">
                    </div>
                </div>
                <!-- Right side -->
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Locality</label>
                        <input type="text" class="form-control" name="locality" placeholder="Locality">
                    </div>
                    <div class="form-group">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" name="city" placeholder="City">
                    </div>
                    <div class="form-group">
                        <label class="form-label">District</label>
                        <input type="text" class="form-control" name="district" placeholder="District">
                    </div>
                    <div class="form-group">
                        <label class="form-label">State</label>
                        <input type="text" class="form-control" name="state" placeholder="State">
                    </div>
                </div>
            </div>
            <div class="text-right mt-3">
    <span id="address-success-message" style="display:none; color:green;">Address added successfully!</span>

                <button type="submit" class="btn btn-success" id="btn-save-address">Add</button>
                <button type="button" class="btn btn-danger" id="btn-cancel ">Cancel</button>
            </div>
        </form>
    </div>

    <div id="address-list">
        <!-- Address list will be displayed here -->
    </div>

    <button type="button" class="btn " style="background-color: #014122; color: #fff ;" id="btn-add-address">Add Address</button>
    <br><br>
    
    <% addresses.forEach(function(address, index) { %>
        <div class="address-container">
            <div class="address-heading">Address <%= index + 1 %></div>
            <div class="address-buttons">
                <a href="/edit-address/<%= address._id %>" class="btn btn-success btn-edit" data-id="<%= address._id %>">Edit</a>
                <!-- <button >Edit</button> -->
                <a class="btn btn-delete btn-danger"  href="/user/deleteaddress/<%= address._id %>">Delete</a>
            </div>
            <div>
                <span><%= user.name %>,</span>
                <span><%= address.mobile %></span>
            </div>
            <div>
                <span><%= address.houseName %></span>
                <span><%= address.locality %>,</span>
                <span><%= address.city %>,</span>
                <span><%= address.district %>,</span>
                <span><%= address.state %> -</span>
                <span><%= address.pincode %></span>
            </div>
        </div>
    <% }); %>
    

</div>






                    </div>
                </div>
            </div>
        </div>
        
    </div><br><br><br><br>
    <!-- <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">

    </script>





<script>
    // change password script ==========================
$(document).ready(function() {
    $("#btn-save-changess").click(function() {
        var currentPassword = $("#current-password").val();
        var newPassword = $("#new-password").val();
        var repeatNewPassword = $("#repeat-new-password").val();
        console.log('currentPassword',currentPassword);
        console.log('newPassword',newPassword);
        console.log('repeatNewPassword',repeatNewPassword);

        if (currentPassword === '' || newPassword === '' || repeatNewPassword === '') {
            showAlert("Please fill in all fields.");
            return;
        }

        if (newPassword !== repeatNewPassword) {
            showAlert("New password and repeated new password do not match.");
            return;
        }

        $.ajax({
            url: "/change-password",
            method: "POST",
            data: {
                currentPassword: currentPassword,
                newPassword: newPassword,
                repeatNewPassword: repeatNewPassword 
            },
            success: function(response) {
                // showAlert(response.message);
                // window.location.reload(); 
                showSuccessAlert(response.message);
            },
            error: function(xhr, status, error) {
                showAlert(xhr.responseJSON.error);
            }
        });
    });


     // Function to display success alert with OK button
     function showSuccessAlert(message) {
        $("#alert-area").html('<div class="alert alert-success" role="alert">' + message + '<button id="ok-button" class="btn btn-primary">OK</button></div>');

        // Handle click event for OK button
        $("#ok-button").click(function() {
            window.location.href = "/user/login"; // Redirect to login page
        });

        // Remove the alert after 3 seconds
        // setTimeout(function() {
        //     $("#alert-area").empty();
        // }, 3000);
    }


    // Function to display alert within the webpage
    function showAlert(message) {
        $("#alert-area").html('<div class="alert alert-danger" role="alert">' + message + '</div>');
        setTimeout(function() {
        $("#alert-area").empty();
    }, 3000);
    }
});

// change password script end=========================

//==========================Address script=============


$(document).ready(function() {
    // Handle form submission
    $('#address-form').submit(function(event) {
        event.preventDefault();
        var formData = $(this).serialize();
        
        $.post('/save-address', formData, function(response) {
            $('#address-form')[0].reset();
            location.reload();
        });
    });

    function addAddress() {
    
    document.getElementById("address-success-message").style.display = "inline";
}
    
    loadAddressList();
    
    function loadAddressList() {
        $.get('/get-addresses', function(addresses) {
            var addressListHtml = '';
            addresses.forEach(function(address) {
                addressListHtml += '<div class="card-body pb-2">';
                addressListHtml += '<p>Mobile: ' + address.mobile + '</p>';
                addressListHtml += '<p>Email: ' + address.email + '</p>';
                addressListHtml += '<div class="text-right mt-3">';
                addressListHtml += '<button type="button" class="btn btn-primary btn-edit" data-id="' + address._id + '">Edit</button>';
                addressListHtml += '<button type="button" class="btn btn-danger btn-delete" data-id="' + address._id + '">Delete</button>';
                addressListHtml += '</div>';
                addressListHtml += '</div>';
            });
            $('#address-list').html(addressListHtml);
        });
    }
    





  
    
// Handle delete button click
$('#address-list').on('click', '.btn-delete', function() {
    var addressId = $(this).data('id');
    $.ajax({
        url: '/delete-address/' + addressId,
        type: 'DELETE', 
        success: function(response) {
            loadAddressList();
        },
        error: function(xhr, status, error) {
            console.error('Error deleting address:', error);
        }
    });
});

    // Handle cancel button click
    $('#btn-cancel').click(function() {
        $('#address-form')[0].reset();
        $('#btn-update-address').text('Add Address').attr('id', 'btn-save-address');
    });
});





//============end address====================




</script>








<script>
    document.getElementById('btn-add-address').addEventListener('click', function() {
        var form = document.getElementById('address-form');
        var addButton = document.getElementById('btn-add-address');
        if (form.style.display === 'none') {
            form.style.display = 'block';
            addButton.style.display = 'none';
        } else {
            form.style.display = 'none';
            addButton.style.display = 'block'; 
        }
    });

    document.getElementById('btn-cancel').addEventListener('click', function() {
        document.getElementById('address-form').style.display = 'none';
        document.getElementById('btn-add-address').style.display = 'block'; 
    });
</script>





<script>



// Handle update button click
$('#address-form').on('click', '#btn-update-address', function() {
    var addressId = $(this).data('id');

    var formData = $('#address-form').serialize();

    $.ajax({
        url: '/update-address/' + addressId,
        type: 'PUT',
        data: formData,
        success: function(response) {
            alert(response.message);
            loadAddressList();
            $('#address-form')[0].reset();
            $('#btn-update-address').text('Add Address').attr('id', 'btn-save-address');
        },
        error: function(xhr, status, error) {
            alert(xhr.responseJSON.error);
        }
    });
});

</script>

<script>
    document.getElementById('btn-save-address').addEventListener('click', function() {
      Swal.fire({
        position: "center",
        icon: "success",
        title: "Your address has been saved",
        showConfirmButton: false,
        timer: 1500
      }).then(function() {
        location.reload();
      });
    });
    </script>

<script>
    document.getElementById('save-changes').addEventListener('click', function() {
      Swal.fire({
        position: "center",
        icon: "success",
        title: "Your name has been changed",
        showConfirmButton: false,
        timer: 1500
      }).then(function() {
        location.reload();
      });
    });
    </script>




<script>
    $(document).ready(function() {
        $('#save-changes').on('click', function() {
            var newName = $('#user-name').val();
            
            $.ajax({
                url: '/save-user',
                type: 'POST',
                data: { name: newName },
                success: function(response) {
                    if (response.success) {
                        alert('User name updated successfully');
                    } else {
                    }
                },
                error: function(xhr, status, error) {
                    console.error(error);
                    alert('An error occurred while updating the user name');
                }
            });
        });
    });
    </script>

<script>
    $(document).ready(function() {
    $('#address-list').on('click', '.btn-edit', function(e) {
        e.preventDefault();
        var addressId = $(this).data('id');
        $.get('/edit-address/' + addressId, function(address) {
            $('#editMobile').val(address.mobile);
            $('#editPincode').val(address.pincode);
           
        });
    });
});

</script>










